<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khám phá Động vật Hoang dã Thế giới</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Biến màu sắc cho chế độ sáng và tối */
        :root {
            --primary-color: #10b981; /* Màu xanh lá cây chính */
            --secondary-color: #065f46; /* Màu xanh lá cây đậm */
            --background-light: #ffffff; /* Nền sáng */
            --text-light: #1f2937; /* Chữ trên nền sáng */
            --background-dark: #1f2937; /* Nền tối */
            --text-dark: #f3f4f6; /* Chữ trên nền tối */
            --transition-duration: 0.3s; /* Thời gian chuyển tiếp mặc định */
        }

        /* Kiểu dáng cơ bản cho body */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color var(--transition-duration), color var(--transition-duration);
            background-image: url('https://images.unsplash.com/photo-1546182990-dffeafbe841d?q=80&w=1000&auto=format&fit=crop'); /* Hình nền mặc định */
            background-size: cover;
            background-position: center;
            background-attachment: fixed; /* Giữ nền cố định khi cuộn */
            background-color: var(--background-light); /* Nền mặc định là sáng */
            color: var(--text-light); /* Màu chữ mặc định */
        }

        /* Kiểu dáng cho chế độ tối */
        body.dark {
            background-color: var(--background-dark);
            color: var(--text-dark);
        }

        /* Lớp phủ để tăng độ tương phản */
        .overlay {
            background-color: rgba(255, 255, 255, 0.6); /* Lớp phủ sáng */
            transition: background-color var(--transition-duration);
        }

        body.dark .overlay {
            background-color: rgba(0, 0, 0, 0.6); /* Lớp phủ tối */
        }

        /* Container chính */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Thanh điều hướng */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 30;
            transition: background-color var(--transition-duration), box-shadow var(--transition-duration);
        }

        /* Thanh điều hướng khi cuộn */
        .navbar.scrolled {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px); /* Hiệu ứng mờ */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        body.dark .navbar.scrolled {
            background-color: rgba(31, 41, 55, 0.8); /* Màu nền tối khi cuộn */
        }

        /* Thẻ lục địa */
        .continent-card {
            background-color: var(--background-light);
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: transform var(--transition-duration), box-shadow var(--transition-duration);
            animation: fadeIn 0.5s ease-out forwards; /* Thêm hiệu ứng fadeIn */
            opacity: 0; /* Bắt đầu ẩn */
        }
        /* Animation delay cho thẻ lục địa */
        .continent-card:nth-child(1) { animation-delay: 0.1s; }
        .continent-card:nth-child(2) { animation-delay: 0.2s; }
        .continent-card:nth-child(3) { animation-delay: 0.3s; }
        .continent-card:nth-child(4) { animation-delay: 0.4s; }
        .continent-card:nth-child(5) { animation-delay: 0.5s; }
        .continent-card:nth-child(6) { animation-delay: 0.6s; }


        body.dark .continent-card {
            background-color: #374151; /* Màu nền tối cho thẻ */
        }

        .continent-card:hover {
            transform: scale(1.03); /* Phóng to nhẹ khi di chuột */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .continent-icon {
            width: 4rem;
            height: 4rem;
            border-radius: 9999px; /* Bo tròn */
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem auto;
        }

        /* --- Modal Styling with Transitions --- */
        .modal {
            display: flex; /* Luôn là flex để căn giữa */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 50;
            overflow-y: auto; /* Cho phép cuộn nếu nội dung dài */
            align-items: center; /* Căn giữa theo chiều dọc */
            justify-content: center; /* Căn giữa theo chiều ngang */
            opacity: 0; /* Ẩn ban đầu */
            visibility: hidden; /* Ẩn hoàn toàn */
            transition: opacity var(--transition-duration) ease-in-out, visibility 0s var(--transition-duration); /* Transition cho opacity và visibility */
        }

        .modal.open {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s; /* Reset delay khi mở */
        }

        /* Lớp phủ nền cho modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 40;
        }

        /* Container nội dung modal */
        .modal-container {
            position: relative;
            background-color: var(--background-light);
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 64rem; /* Chiều rộng tối đa */
            width: 90%; /* Chiều rộng tương đối */
            margin: 2rem auto; /* Canh giữa */
            max-height: 90vh; /* Chiều cao tối đa */
            overflow: hidden; /* Ẩn phần thừa */
            z-index: 50;
            transform: scale(0.95) translateY(10px); /* Hiệu ứng thu nhỏ ban đầu */
            transition: transform var(--transition-duration) ease-in-out;
            display: flex; /* Use flex for content */
            flex-direction: column; /* Stack content vertically */
        }

        .modal.open .modal-container {
            transform: scale(1) translateY(0); /* Phóng to về kích thước gốc khi mở */
        }


        body.dark .modal-container {
            background-color: #374151; /* Nền tối cho modal */
            color: var(--text-dark);
        }

        /* Phần nội dung chính của modal (để cuộn) */
        .modal-content-area {
             padding: 1.5rem; /* 24px */
             overflow-y: auto; /* Enable scrolling for this area */
             flex-grow: 1; /* Allow this area to grow */
        }

        /* Thẻ quốc gia */
        .country-card {
            background-color: var(--background-light);
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            padding: 1rem;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: transform var(--transition-duration), box-shadow var(--transition-duration);
            animation: fadeIn 0.3s ease-out forwards; /* Hiệu ứng fadeIn */
            opacity: 0; /* Bắt đầu ẩn */
        }

        body.dark .country-card {
            background-color: #4b5563;
        }

        .country-card:hover {
            transform: translateY(-5px); /* Nhấc lên khi di chuột */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Container cờ quốc gia */
        .flag-container {
            width: 3rem;
            height: 2rem;
            position: relative;
            margin-right: 0.75rem;
            overflow: hidden;
            border-radius: 0.25rem;
            border: 1px solid #e5e7eb; /* Viền sáng */
        }

        body.dark .flag-container {
            border-color: #6b7280; /* Viền tối */
        }

        .flag-img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Đảm bảo ảnh cờ vừa vặn */
        }

        /* Thẻ động vật */
        .animal-card {
            background-color: var(--background-light);
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            height: 100%; /* Đảm bảo chiều cao bằng nhau */
            transition: transform var(--transition-duration), box-shadow var(--transition-duration);
            animation: fadeIn 0.4s ease-out forwards; /* Hiệu ứng fadeIn */
            opacity: 0; /* Bắt đầu ẩn */
        }

        body.dark .animal-card {
            background-color: #4b5563;
        }

        .animal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Container ảnh động vật */
        .animal-img-container {
            position: relative;
            height: 12rem; /* Chiều cao cố định */
            width: 100%;
            overflow: hidden;
        }

        .animal-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s; /* Hiệu ứng phóng to ảnh */
        }

        .animal-card:hover .animal-img {
            transform: scale(1.1); /* Phóng to ảnh khi di chuột */
        }

        /* Lớp phủ trên ảnh động vật */
        .animal-overlay {
            position: absolute;
            inset: 0; /* Bao phủ toàn bộ */
            background: linear-gradient(to top, rgba(0, 0, 0, 0.6), transparent); /* Gradient đen mờ */
            opacity: 0; /* Ẩn mặc định */
            transition: opacity var(--transition-duration);
        }

        .animal-card:hover .animal-overlay {
            opacity: 1; /* Hiện khi di chuột */
        }

        /* Nút yêu thích */
        .favorite-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.5rem;
            border-radius: 9999px;
            background-color: rgba(255, 255, 255, 0.8);
            color: #4b5563;
            transition: background-color var(--transition-duration), color var(--transition-duration);
            border: none; /* Loại bỏ viền mặc định của button */
            cursor: pointer; /* Con trỏ chuột */
            z-index: 10; /* Đảm bảo nút nằm trên overlay */
        }

        .favorite-btn.active {
            background-color: #ef4444; /* Màu đỏ khi active */
            color: white;
        }

        /* Nút thông tin */
        .info-btn {
            position: absolute;
            bottom: 0.5rem;
            right: 0.5rem;
            padding: 0.5rem;
            border-radius: 9999px;
            background-color: rgba(255, 255, 255, 0.8);
            color: #4b5563;
            opacity: 0; /* Ẩn mặc định */
            transition: opacity var(--transition-duration);
            border: none; /* Loại bỏ viền mặc định của button */
            cursor: pointer; /* Con trỏ chuột */
            z-index: 10; /* Đảm bảo nút nằm trên overlay */
        }

        .animal-card:hover .info-btn {
            opacity: 1; /* Hiện khi di chuột */
        }

        /* Nội dung thẻ động vật */
        .animal-content {
            padding: 1rem;
        }

        .animal-title {
            font-size: 1.25rem; /* Cỡ chữ lớn hơn */
            font-weight: 700; /* Đậm */
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        body.dark .animal-title {
            color: var(--text-dark);
        }

        .animal-description {
            color: #6b7280;
            display: -webkit-box;
            -webkit-line-clamp: 3; /* Giới hạn 3 dòng */
            -webkit-box-orient: vertical;
            overflow: hidden; /* Ẩn phần thừa */
        }

        body.dark .animal-description {
            color: #d1d5db;
        }

        /* Modal chi tiết động vật */
        .animal-detail-modal {
            /* Sử dụng chung kiểu .modal */
            z-index: 60; /* Cao hơn modal thường */
        }

        /* Container chi tiết động vật */
        .animal-detail-container {
            /* Sử dụng chung kiểu .modal-container */
             z-index: 60;
             max-width: 64rem;
             width: 90%;
             margin: 2rem auto;
             max-height: 90vh;
        }

        body.dark .animal-detail-container {
            background-color: #374151;
            color: var(--text-dark);
        }

        /* Ảnh chi tiết động vật */
        .animal-detail-img {
            position: relative;
            height: 24rem; /* Chiều cao lớn hơn */
            width: 100%;
        }

        .animal-detail-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Lớp phủ trên ảnh chi tiết */
        .animal-detail-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent);
        }

        /* Tiêu đề chi tiết động vật */
        .animal-detail-title {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            right: 1rem;
            color: white;
            font-size: 1.875rem;
            font-weight: 700;
        }

        /* Nội dung chi tiết động vật */
        .animal-detail-content {
            padding: 1.5rem;
            overflow-y: auto; /* Cho phép cuộn nếu nội dung dài */
            /* Tính toán max-height dựa trên chiều cao ảnh và padding */
            max-height: calc(90vh - 24rem - 4rem); /* 90vh - image height - top/bottom margin */
        }

        /* Ngăn kéo yêu thích */
        .favorites-drawer {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 24rem; /* Chiều rộng cố định */
            max-width: 100%; /* Đảm bảo không vượt quá màn hình */
            background-color: var(--background-light);
            box-shadow: -10px 0 15px -5px rgba(0, 0, 0, 0.1); /* Đổ bóng bên trái */
            z-index: 45; /* Dưới modal nhưng trên overlay */
            transform: translateX(100%); /* Ẩn bên phải */
            transition: transform var(--transition-duration) ease-in-out;
            visibility: hidden; /* Ẩn ban đầu */
        }

        body.dark .favorites-drawer {
            background-color: #374151;
            color: var(--text-dark);
        }

        .favorites-drawer.open {
            transform: translateX(0); /* Hiện ra */
            visibility: visible;
        }

        /* Mục yêu thích */
        .favorite-item {
            display: flex;
            padding: 0.75rem;
            background-color: var(--background-light);
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 0.75rem;
            animation: fadeIn 0.3s ease-out forwards;
            opacity: 0;
        }
         /* Delay cho mục yêu thích */
         .favorite-item:nth-child(1) { animation-delay: 0.1s; }
         .favorite-item:nth-child(2) { animation-delay: 0.15s; }
         .favorite-item:nth-child(3) { animation-delay: 0.2s; }
         /* ... thêm nếu cần */

        body.dark .favorite-item {
            background-color: #4b5563;
        }

        /* Ảnh mục yêu thích */
        .favorite-item-img {
            width: 5rem;
            height: 5rem;
            border-radius: 0.375rem;
            overflow: hidden;
            margin-right: 0.75rem;
            flex-shrink: 0; /* Ngăn co lại */
        }

        .favorite-item-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Container câu đố */
        .quiz-container {
            background-color: var(--background-light);
            border-radius: 0.75rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body.dark .quiz-container {
            background-color: #374151;
        }

        /* Lựa chọn câu đố */
        .quiz-option {
            width: 100%;
            text-align: left;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            margin-bottom: 0.75rem;
            transition: background-color 0.2s, border-color 0.2s, color 0.2s, opacity 0.2s;
            cursor: pointer;
            background-color: var(--background-light); /* Thêm màu nền */
            color: var(--text-light); /* Thêm màu chữ */
        }

        body.dark .quiz-option {
            border-color: #6b7280;
            background-color: #4b5563;
            color: var(--text-dark);
        }

        .quiz-option:hover:not(.correct):not(.incorrect):not(:disabled) { /* Chỉ hover khi chưa chọn và chưa bị disable */
            background-color: #f3f4f6;
        }

        body.dark .quiz-option:hover:not(.correct):not(.incorrect):not(:disabled) {
            background-color: #525e70; /* Màu hover tối hơn */
        }

        .quiz-option.correct {
            background-color: #d1fae5; /* Xanh lá cây nhạt */
            border-color: #10b981;
            color: #065f46; /* Màu chữ đậm hơn */
            cursor: default; /* Không cho click lại */
        }

        body.dark .quiz-option.correct {
            background-color: #065f46;
            border-color: #10b981;
            color: #d1fae5;
        }

        .quiz-option.incorrect {
            background-color: #fee2e2; /* Đỏ nhạt */
            border-color: #ef4444;
            color: #b91c1c; /* Màu chữ đậm hơn */
            cursor: default; /* Không cho click lại */
        }

        body.dark .quiz-option.incorrect {
            background-color: #7f1d1d;
            border-color: #ef4444;
            color: #fee2e2;
        }

         .quiz-option:disabled {
             cursor: default;
             opacity: 0.7;
         }
         .quiz-option.correct:disabled, .quiz-option.incorrect:disabled {
             opacity: 1; /* Giữ nguyên độ rõ cho đáp án đúng/sai */
         }


        /* Thanh tiến trình */
        .progress-bar {
            height: 0.5rem;
            background-color: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
        }

        body.dark .progress-bar {
            background-color: #4b5563;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--primary-color);
            transition: width var(--transition-duration);
        }

        /* Phần bảo tồn */
        .conservation-section {
            background-color: #f0fdf4; /* Nền xanh lá cây rất nhạt */
            padding: 3rem 0;
            border-radius: 1rem;
        }

        body.dark .conservation-section {
            background-color: #052e16; /* Nền xanh lá cây rất đậm */
        }

        /* Thẻ bảo tồn */
        .conservation-card {
            background-color: white;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            height: 100%;
            transition: transform var(--transition-duration), box-shadow var(--transition-duration);
            padding: 1.5rem; /* Thêm padding */
        }

        body.dark .conservation-card {
            background-color: #1f2937;
        }

        .conservation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .conservation-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            color: white; /* Màu icon trắng */
        }

        /* Nội dung tab */
        .tab-content {
            display: none; /* Ẩn mặc định */
            animation: fadeIn 0.5s ease-out; /* Hiệu ứng khi chuyển tab */
        }

        .tab-content.active {
            display: block; /* Hiện tab đang active */
        }

        /* Nút tab */
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color var(--transition-duration), color var(--transition-duration);
            border: none;
            cursor: pointer;
            margin-right: 0.5rem; /* Khoảng cách giữa các nút */
        }
        .tab-button:last-child {
             margin-right: 0;
        }

        .tab-button.active {
            background-color: var(--primary-color);
            color: white;
        }

        body.dark .tab-button.active {
            background-color: var(--secondary-color);
        }

        .tab-button:not(.active) {
            background-color: #f3f4f6;
            color: #4b5563;
        }

        body.dark .tab-button:not(.active) {
            background-color: #374151;
            color: #d1d5db;
        }
         body.dark .tab-button:not(.active):hover {
             background-color: #4b5563; /* Thêm hiệu ứng hover */
         }
         .tab-button:not(.active):hover {
             background-color: #e5e7eb; /* Thêm hiệu ứng hover */
         }


        /* Thẻ tổ chức */
        .organization-card {
            background-color: white;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            height: 100%;
            transition: transform var(--transition-duration), box-shadow var(--transition-duration);
            padding: 1.5rem; /* Thêm padding */
            display: flex; /* Sử dụng flexbox */
            flex-direction: column; /* Sắp xếp theo chiều dọc */
             animation: fadeIn 0.4s ease-out forwards;
             opacity: 0;
        }
        /* Delay cho thẻ tổ chức */
        .organization-card:nth-child(1) { animation-delay: 0.1s; }
        .organization-card:nth-child(2) { animation-delay: 0.2s; }
        .organization-card:nth-child(3) { animation-delay: 0.3s; }

        body.dark .organization-card {
            background-color: #1f2937;
        }

        .organization-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* Huy hiệu */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem; /* Sửa lỗi font-size */
            font-weight: 600; /* Sửa lỗi font-weight */
        }

        .badge-green { background-color: #d1fae5; color: #065f46; }
        body.dark .badge-green { background-color: #065f46; color: #d1fae5; }
        .badge-red { background-color: #fee2e2; color: #b91c1c; }
        body.dark .badge-red { background-color: #7f1d1d; color: #fee2e2; }
        .badge-yellow { background-color: #fef3c7; color: #92400e; }
        body.dark .badge-yellow { background-color: #78350f; color: #fef3c7; }
        .badge-blue { background-color: #dbeafe; color: #1e40af; }
        body.dark .badge-blue { background-color: #1e3a8a; color: #dbeafe; }
        .badge-gray { background-color: #e5e7eb; color: #4b5563; }
        body.dark .badge-gray { background-color: #4b5563; color: #e5e7eb; }


        /* Responsive */
        @media (max-width: 768px) {
            .continent-grid { grid-template-columns: repeat(1, 1fr); }
            .country-grid { grid-template-columns: repeat(1, 1fr); }
            .animal-grid, .modal-animal-grid { grid-template-columns: repeat(1, 1fr); } /* Apply to modal grid too */
            .favorites-drawer { width: 100%; }
        }

        @media (min-width: 640px) {
            .continent-grid { grid-template-columns: repeat(2, 1fr); }
            .country-grid { grid-template-columns: repeat(2, 1fr); }
            .animal-grid, .modal-animal-grid { grid-template-columns: repeat(2, 1fr); } /* Apply to modal grid too */
        }

        @media (min-width: 1024px) {
            .continent-grid { grid-template-columns: repeat(3, 1fr); }
            .country-grid { grid-template-columns: repeat(3, 1fr); }
            .animal-grid, .modal-animal-grid { grid-template-columns: repeat(3, 1fr); } /* Apply to modal grid too */
        }

        /* Hiệu ứng nổi */
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        /* Hiệu ứng Fade In */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Kiểu dáng mối đe dọa bảo tồn */
        .conservation-threat {
            border-left-width: 4px;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
        }
        .conservation-threat:nth-child(1) { animation-delay: 0.1s; }
        .conservation-threat:nth-child(2) { animation-delay: 0.2s; }
        .conservation-threat:nth-child(3) { animation-delay: 0.3s; }
        .conservation-threat:nth-child(4) { animation-delay: 0.4s; }


        .conservation-threat.habitat-loss { border-left-color: #ef4444; background-color: rgba(239, 68, 68, 0.1); }
        .conservation-threat.poaching { border-left-color: #f97316; background-color: rgba(249, 115, 22, 0.1); }
        .conservation-threat.climate-change { border-left-color: #eab308; background-color: rgba(234, 179, 8, 0.1); }
        .conservation-threat.pollution { border-left-color: #3b82f6; background-color: rgba(59, 130, 246, 0.1); }

        body.dark .conservation-threat.habitat-loss { background-color: rgba(239, 68, 68, 0.2); }
        body.dark .conservation-threat.poaching { background-color: rgba(249, 115, 22, 0.2); }
        body.dark .conservation-threat.climate-change { background-color: rgba(234, 179, 8, 0.2); }
        body.dark .conservation-threat.pollution { background-color: rgba(59, 130, 246, 0.2); }

        /* Kiểu dáng bản đồ */
        .map-container {
            position: relative;
            width: 100%;
            height: 500px; /* Chiều cao cố định */
            background-color: #f3f4f6;
            border-radius: 0.5rem;
            overflow: hidden;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/8/80/World_map_-_low_resolution.svg'); /* Ảnh bản đồ thế giới đơn giản */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            transition: background-color var(--transition-duration), filter var(--transition-duration);
        }

        body.dark .map-container {
            background-color: #374151;
            filter: invert(1) hue-rotate(180deg); /* Đảo ngược màu cho bản đồ tối */
        }

        /* Đánh dấu trên bản đồ */
        .map-marker {
            position: absolute;
            cursor: pointer;
        }

        .map-marker-dot {
            width: 1rem;
            height: 1rem;
            background-color: #ef4444; /* Màu đỏ */
            border-radius: 9999px;
            position: relative;
            border: 2px solid white; /* Viền trắng để nổi bật */
        }

        /* Hiệu ứng ping */
        .map-marker-dot::before {
            content: '';
            position: absolute;
            inset: -2px; /* Lớn hơn chấm một chút */
            border-radius: 9999px;
            background-color: #ef4444;
            animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;
            z-index: -1; /* Nằm dưới chấm */
        }

        @keyframes ping {
            75%, 100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* Tooltip cho marker */
        .map-marker-tooltip {
            position: absolute;
            left: 1.5rem; /* Bên phải marker */
            top: 50%; /* Canh giữa theo chiều dọc */
            transform: translateY(-50%);
            width: 12rem; /* Chiều rộng cố định */
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 0.75rem;
            opacity: 0; /* Ẩn mặc định */
            pointer-events: none; /* Không tương tác được */
            transition: opacity var(--transition-duration);
            z-index: 10;
            font-size: 0.875rem; /* Cỡ chữ nhỏ hơn */
        }

        body.dark .map-marker-tooltip {
            background-color: #1f2937;
            color: var(--text-dark); /* Đảm bảo chữ đọc được */
        }

        .map-marker:hover .map-marker-tooltip {
            opacity: 1; /* Hiện khi di chuột vào marker */
            pointer-events: auto; /* Cho phép tương tác */
        }

        /* Đảm bảo độ tương phản màu chữ trong chế độ tối */
        body.dark { color: #e5e7eb; }
        body.dark .text-gray-800 { color: #f9fafb !important; }
        body.dark .text-gray-700 { color: #f3f4f6 !important; }
        body.dark .text-gray-600 { color: #d1d5db !important; }
        body.dark .text-gray-500 { color: #9ca3af !important; }
        body.dark a { color: #60a5fa; } /* Màu link sáng hơn */
        body.dark a:hover { color: #93c5fd; }

        /* Phần tìm hiểu thêm */
        .learn-more-section {
            background-color: #f8fafc;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        body.dark .learn-more-section {
            background-color: #1f2937;
        }

        .learn-more-section h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #111827;
        }

        body.dark .learn-more-section h3 {
            color: #f3f4f6;
        }

        .learn-more-section p {
            margin-bottom: 1rem;
            color: var(--text-light); /* Sử dụng biến màu */
        }
        body.dark .learn-more-section p {
            color: var(--text-dark); /* Sử dụng biến màu */
        }

        /* Nút đóng modal */
        .close-button {
             position: absolute;
             top: 0.75rem;
             right: 0.75rem;
             padding: 0.5rem;
             border-radius: 9999px;
             background-color: rgba(0, 0, 0, 0.3);
             color: white;
             border: none;
             cursor: pointer;
             z-index: 55; /* Đảm bảo nằm trên nội dung modal */
             line-height: 1; /* Đảm bảo icon căn giữa */
             transition: background-color var(--transition-duration);
        }
         body.dark .close-button {
             background-color: rgba(255, 255, 255, 0.3);
             color: var(--text-dark);
         }

        .close-button:hover {
             background-color: rgba(0, 0, 0, 0.5);
        }
         body.dark .close-button:hover {
             background-color: rgba(255, 255, 255, 0.5);
         }

         /* Nút quay lại trong modal quốc gia/động vật */
         #modal-back-button {
             position: absolute;
             top: 0.75rem;
             left: 0.75rem;
             padding: 0.5rem;
             border-radius: 9999px;
             background-color: rgba(0, 0, 0, 0.3);
             color: white;
             border: none;
             cursor: pointer;
             z-index: 55;
             line-height: 1;
             transition: background-color var(--transition-duration), opacity var(--transition-duration), visibility var(--transition-duration);
             opacity: 0;
             visibility: hidden;
         }
         #modal-back-button.visible {
             opacity: 1;
             visibility: visible;
         }
          body.dark #modal-back-button {
             background-color: rgba(255, 255, 255, 0.3);
             color: var(--text-dark);
         }
         #modal-back-button:hover {
              background-color: rgba(0, 0, 0, 0.5);
         }
          body.dark #modal-back-button:hover {
              background-color: rgba(255, 255, 255, 0.5);
          }


         /* Nút đóng drawer */
         .close-drawer-button {
             position: absolute;
             top: 0.75rem;
             right: 0.75rem;
             padding: 0.5rem;
             border-radius: 0.5rem;
             background-color: #f3f4f6;
             color: #4b5563;
             border: none;
             cursor: pointer;
             line-height: 1;
             transition: background-color var(--transition-duration);
         }
          body.dark .close-drawer-button {
             background-color: #4b5563;
             color: #e5e7eb;
          }
         .close-drawer-button:hover {
              background-color: #e5e7eb;
         }
          body.dark .close-drawer-button:hover {
              background-color: #6b7280;
          }

        /* Nút xóa khỏi yêu thích */
        .remove-favorite-btn {
            background: none;
            border: none;
            color: #ef4444; /* Màu đỏ */
            cursor: pointer;
            margin-left: auto; /* Đẩy sang phải */
            padding: 0.25rem;
            transition: color var(--transition-duration);
        }
        body.dark .remove-favorite-btn {
            color: #fca5a5; /* Màu đỏ nhạt hơn */
        }
        .remove-favorite-btn:hover {
            color: #b91c1c;
        }
         body.dark .remove-favorite-btn:hover {
             color: #ef4444;
         }

         /* Class tiện ích để ẩn */
         .hidden {
             display: none !important; /* Use important to override grid/flex */
         }

         /* Class để khóa cuộn body */
         .body-no-scroll {
             overflow: hidden;
         }

    </style>
</head>
<body class="antialiased"> <div class="overlay fixed inset-0 z-[-1]"></div>

    <nav id="navbar" class="navbar p-4 text-gray-800 dark:text-gray-200">
        <div class="container mx-auto flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-emerald-600 dark:text-emerald-400">
                <i class="fas fa-paw mr-2"></i>Wildlife Explorer
            </a>
            <div class="flex items-center space-x-4">
                <button id="favorites-toggle" aria-label="Xem yêu thích" class="relative p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i class="fas fa-heart text-xl text-red-500"></i>
                    <span id="favorites-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold rounded-full px-1.5 py-0.5 hidden">0</span>
                </button>
                <button id="theme-toggle" aria-label="Chuyển đổi giao diện" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i class="fas fa-moon text-xl"></i> </button>
                 <a href="#quiz-section" class="hidden md:inline-block px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg font-semibold transition duration-300">
                    Thử thách Quiz!
                 </a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto pt-24 pb-12"> <section class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-extrabold mb-4 text-gray-900 dark:text-white animate-float">Khám phá Thế giới Động vật Hoang dã</h1>
            <p class="text-lg text-gray-600 dark:text-gray-300 max-w-3xl mx-auto">
                Bắt đầu hành trình khám phá sự đa dạng sinh học đáng kinh ngạc trên khắp các lục địa. Tìm hiểu về các loài động vật độc đáo và môi trường sống của chúng.
            </p>
        </section>

        <section id="continents" class="mb-16">
            <h2 class="text-3xl font-bold mb-8 text-center text-gray-800 dark:text-gray-200">Khám phá theo Lục địa</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 continent-grid">
                <div class="continent-card text-center p-6 cursor-pointer" data-continent="Châu Phi">
                    <div class="continent-icon bg-yellow-500 text-white"><i class="fas fa-globe-africa text-2xl"></i></div>
                    <h3 class="text-xl font-semibold mb-2 text-gray-800 dark:text-gray-200">Châu Phi</h3>
                    <p class="text-gray-600 dark:text-gray-400">Vùng đất của savan rộng lớn và sa mạc hùng vĩ.</p>
                </div>
                 <div class="continent-card text-center p-6 cursor-pointer" data-continent="Châu Á">
                    <div class="continent-icon bg-red-500 text-white"><i class="fas fa-globe-asia text-2xl"></i></div>
                    <h3 class="text-xl font-semibold mb-2 text-gray-800 dark:text-gray-200">Châu Á</h3>
                    <p class="text-gray-600 dark:text-gray-400">Nơi có những khu rừng nhiệt đới và dãy núi cao nhất.</p>
                </div>
                 <div class="continent-card text-center p-6 cursor-pointer" data-continent="Châu Âu">
                    <div class="continent-icon bg-blue-500 text-white"><i class="fas fa-globe-europe text-2xl"></i></div>
                    <h3 class="text-xl font-semibold mb-2 text-gray-800 dark:text-gray-200">Châu Âu</h3>
                    <p class="text-gray-600 dark:text-gray-400">Đa dạng từ bờ biển Địa Trung Hải đến rừng phương Bắc.</p>
                </div>
                 <div class="continent-card text-center p-6 cursor-pointer" data-continent="Bắc Mỹ">
                    <div class="continent-icon bg-green-500 text-white"><i class="fas fa-globe-americas text-2xl"></i></div>
                    <h3 class="text-xl font-semibold mb-2 text-gray-800 dark:text-gray-200">Bắc Mỹ</h3>
                    <p class="text-gray-600 dark:text-gray-400">Từ lãnh nguyên băng giá đến sa mạc nóng bỏng.</p>
                </div>
                 <div class="continent-card text-center p-6 cursor-pointer" data-continent="Nam Mỹ">
                    <div class="continent-icon bg-purple-500 text-white"><i class="fas fa-globe-americas text-2xl"></i></div>
                    <h3 class="text-xl font-semibold mb-2 text-gray-800 dark:text-gray-200">Nam Mỹ</h3>
                    <p class="text-gray-600 dark:text-gray-400">Quê hương của rừng mưa Amazon và dãy Andes.</p>
                </div>
                 <div class="continent-card text-center p-6 cursor-pointer" data-continent="Châu Đại Dương">
                    <div class="continent-icon bg-orange-500 text-white"><i class="fas fa-globe text-2xl"></i></div>
                    <h3 class="text-xl font-semibold mb-2 text-gray-800 dark:text-gray-200">Châu Đại Dương</h3>
                    <p class="text-gray-600 dark:text-gray-400">Vùng đất của những hòn đảo và loài thú có túi độc đáo.</p>
                </div>
            </div>
        </section>

        <section id="conservation-learn" class="mb-16 bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg">
             <div class="flex flex-wrap justify-center mb-6 border-b border-gray-200 dark:border-gray-700">
                <button class="tab-button active" data-tab="conservation">Bảo tồn Động vật</button>
                <button class="tab-button" data-tab="map">Bản đồ Phân bố</button>
                <button class="tab-button" data-tab="organizations">Tổ chức Bảo tồn</button>
             </div>

             <div id="conservation-tab" class="tab-content active">
                 <h2 class="text-3xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200">Nỗ lực Bảo tồn Toàn cầu</h2>
                 <p class="text-center text-gray-600 dark:text-gray-400 mb-8 max-w-2xl mx-auto">
                     Nhiều loài động vật đang đối mặt với nguy cơ tuyệt chủng do các hoạt động của con người. Cùng tìm hiểu về các mối đe dọa và cách chúng ta có thể giúp đỡ.
                 </p>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                     <div>
                         <h3 class="text-xl font-semibold mb-4 text-gray-700 dark:text-gray-300">Các Mối Đe dọa Chính</h3>
                         <div class="space-y-4">
                             <div class="conservation-threat habitat-loss">
                                 <h4 class="font-semibold text-red-700 dark:text-red-400"><i class="fas fa-house-damage mr-2"></i>Mất môi trường sống</h4>
                                 <p class="text-sm text-gray-600 dark:text-gray-400">Phá rừng, đô thị hóa và nông nghiệp làm thu hẹp không gian sống của động vật.</p>
                             </div>
                             <div class="conservation-threat poaching">
                                 <h4 class="font-semibold text-orange-700 dark:text-orange-400"><i class="fas fa-skull-crossbones mr-2"></i>Săn bắt trái phép</h4>
                                 <p class="text-sm text-gray-600 dark:text-gray-400">Buôn bán động vật hoang dã và các bộ phận cơ thể chúng là mối đe dọa nghiêm trọng.</p>
                             </div>
                             <div class="conservation-threat climate-change">
                                 <h4 class="font-semibold text-yellow-700 dark:text-yellow-400"><i class="fas fa-temperature-high mr-2"></i>Biến đổi khí hậu</h4>
                                 <p class="text-sm text-gray-600 dark:text-gray-400">Thay đổi nhiệt độ và hình thái thời tiết ảnh hưởng đến hệ sinh thái và nguồn thức ăn.</p>
                             </div>
                              <div class="conservation-threat pollution">
                                 <h4 class="font-semibold text-blue-700 dark:text-blue-400"><i class="fas fa-smog mr-2"></i>Ô nhiễm</h4>
                                 <p class="text-sm text-gray-600 dark:text-gray-400">Ô nhiễm nhựa, hóa chất và tiếng ồn gây hại trực tiếp đến sức khỏe động vật.</p>
                             </div>
                         </div>
                     </div>
                     <div>
                         <h3 class="text-xl font-semibold mb-4 text-gray-700 dark:text-gray-300">Chúng ta có thể làm gì?</h3>
                         <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                              <div class="conservation-card bg-emerald-50 dark:bg-emerald-900/50">
                                 <div class="conservation-icon bg-emerald-500"><i class="fas fa-leaf"></i></div>
                                 <h4 class="font-semibold mb-1 text-gray-800 dark:text-gray-200">Hỗ trợ Tổ chức</h4>
                                 <p class="text-sm text-gray-600 dark:text-gray-400">Quyên góp hoặc tình nguyện cho các tổ chức bảo tồn uy tín.</p>
                             </div>
                              <div class="conservation-card bg-blue-50 dark:bg-blue-900/50">
                                 <div class="conservation-icon bg-blue-500"><i class="fas fa-recycle"></i></div>
                                 <h4 class="font-semibold mb-1 text-gray-800 dark:text-gray-200">Giảm thiểu Rác thải</h4>
                                 <p class="text-sm text-gray-600 dark:text-gray-400">Tái chế, tái sử dụng và giảm tiêu thụ nhựa để bảo vệ môi trường.</p>
                             </div>
                              <div class="conservation-card bg-yellow-50 dark:bg-yellow-900/50">
                                 <div class="conservation-icon bg-yellow-500"><i class="fas fa-lightbulb"></i></div>
                                 <h4 class="font-semibold mb-1 text-gray-800 dark:text-gray-200">Nâng cao Nhận thức</h4>
                                 <p class="text-sm text-gray-600 dark:text-gray-400">Chia sẻ kiến thức về bảo tồn với gia đình và bạn bè.</p>
                             </div>
                              <div class="conservation-card bg-red-50 dark:bg-red-900/50">
                                 <div class="conservation-icon bg-red-500"><i class="fas fa-shopping-cart"></i></div>
                                 <h4 class="font-semibold mb-1 text-gray-800 dark:text-gray-200">Tiêu dùng Bền vững</h4>
                                 <p class="text-sm text-gray-600 dark:text-gray-400">Tránh mua các sản phẩm từ động vật hoang dã bị đe dọa.</p>
                             </div>
                         </div>
                         <button id="endangered-species-btn" class="mt-6 w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                             <i class="fas fa-exclamation-triangle mr-2"></i>Xem các loài bị đe dọa
                         </button>
                     </div>
                 </div>
             </div>

             <div id="map-tab" class="tab-content">
                 <h2 class="text-3xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200">Bản đồ Phân bố Động vật</h2>
                 <p class="text-center text-gray-600 dark:text-gray-400 mb-8 max-w-2xl mx-auto">
                     Di chuột qua các điểm đánh dấu để xem một số loài động vật tiêu biểu ở các khu vực khác nhau trên thế giới.
                 </p>
                 <div class="map-container" id="map-container">
                     <div class="map-marker" style="left: 50%; top: 40%;" data-animal="Sư tử" data-info="Vua của đồng cỏ châu Phi.">
                         <div class="map-marker-dot"></div>
                         <div class="map-marker-tooltip">
                             <h4 class="font-semibold text-sm mb-1">Sư tử</h4>
                             <p class="text-xs">Vua của đồng cỏ châu Phi.</p>
                         </div>
                     </div>
                      <div class="map-marker" style="left: 75%; top: 45%;" data-animal="Hổ" data-info="Loài mèo lớn nhất thế giới, sống ở châu Á.">
                         <div class="map-marker-dot"></div>
                         <div class="map-marker-tooltip">
                             <h4 class="font-semibold text-sm mb-1">Hổ</h4>
                             <p class="text-xs">Loài mèo lớn nhất thế giới, sống ở châu Á.</p>
                         </div>
                     </div>
                     <div class="map-marker" style="left: 85%; top: 75%;" data-animal="Kangaroo" data-info="Loài thú có túi đặc trưng của Úc.">
                         <div class="map-marker-dot"></div>
                         <div class="map-marker-tooltip">
                             <h4 class="font-semibold text-sm mb-1">Kangaroo</h4>
                             <p class="text-xs">Loài thú có túi đặc trưng của Úc.</p>
                         </div>
                     </div>
                      <div class="map-marker" style="left: 25%; top: 30%;" data-animal="Gấu xám" data-info="Loài gấu lớn sống ở Bắc Mỹ.">
                         <div class="map-marker-dot"></div>
                         <div class="map-marker-tooltip">
                             <h4 class="font-semibold text-sm mb-1">Gấu xám</h4>
                             <p class="text-xs">Loài gấu lớn sống ở Bắc Mỹ.</p>
                         </div>
                     </div>
                      <div class="map-marker" style="left: 35%; top: 65%;" data-animal="Báo đốm" data-info="Loài mèo lớn mạnh mẽ của rừng rậm Nam Mỹ.">
                         <div class="map-marker-dot"></div>
                         <div class="map-marker-tooltip">
                             <h4 class="font-semibold text-sm mb-1">Báo đốm</h4>
                             <p class="text-xs">Loài mèo lớn mạnh mẽ của rừng rậm Nam Mỹ.</p>
                         </div>
                     </div>
                 </div>
             </div>

             <div id="organizations-tab" class="tab-content">
                 <h2 class="text-3xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200">Các Tổ chức Bảo tồn Hàng đầu</h2>
                 <p class="text-center text-gray-600 dark:text-gray-400 mb-8 max-w-2xl mx-auto">
                     Tìm hiểu và hỗ trợ các tổ chức đang làm việc không mệt mỏi để bảo vệ động vật hoang dã và môi trường sống của chúng trên toàn thế giới.
                 </p>
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                     <div class="organization-card">
                         <img src="https://placehold.co/300x150/a16207/FFFFFF?text=WWF+Logo" alt="Logo WWF" class="w-24 h-auto mx-auto mb-4" onerror="this.src='https://placehold.co/100x50/cccccc/FFFFFF?text=Logo'">
                         <h3 class="text-xl font-semibold mb-2 text-center text-gray-800 dark:text-gray-200">WWF (Quỹ Quốc tế Bảo vệ Thiên nhiên)</h3>
                         <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 flex-grow">Hoạt động trên toàn cầu trong các lĩnh vực bảo tồn khí hậu, thực phẩm, rừng, nước ngọt, đại dương và động vật hoang dã.</p>
                         <a href="https://www.worldwildlife.org/" target="_blank" rel="noopener noreferrer" class="block w-full text-center bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                             Tìm hiểu thêm <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                         </a>
                     </div>
                     <div class="organization-card">
                         <img src="https://placehold.co/300x150/1e40af/FFFFFF?text=IUCN+Logo" alt="Logo IUCN" class="w-24 h-auto mx-auto mb-4" onerror="this.src='https://placehold.co/100x50/cccccc/FFFFFF?text=Logo'">
                         <h3 class="text-xl font-semibold mb-2 text-center text-gray-800 dark:text-gray-200">IUCN (Liên minh Bảo tồn Thiên nhiên Quốc tế)</h3>
                         <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 flex-grow">Nổi tiếng với Sách Đỏ IUCN về các loài bị đe dọa, cung cấp kiến thức và công cụ cho nỗ lực bảo tồn.</p>
                         <a href="https://www.iucn.org/" target="_blank" rel="noopener noreferrer" class="block w-full text-center bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                             Tìm hiểu thêm <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                         </a>
                     </div>
                     <div class="organization-card">
                         <img src="https://placehold.co/300x150/15803d/FFFFFF?text=WCS+Logo" alt="Logo WCS" class="w-24 h-auto mx-auto mb-4" onerror="this.src='https://placehold.co/100x50/cccccc/FFFFFF?text=Logo'">
                         <h3 class="text-xl font-semibold mb-2 text-center text-gray-800 dark:text-gray-200">WCS (Hiệp hội Bảo tồn Động vật Hoang dã)</h3>
                         <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 flex-grow">Thực hiện các chương trình bảo tồn thực địa tại gần 60 quốc gia và quản lý 5 công viên động vật hoang dã ở New York.</p>
                         <a href="https://www.wcs.org/" target="_blank" rel="noopener noreferrer" class="block w-full text-center bg-green-700 hover:bg-green-800 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                             Tìm hiểu thêm <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                         </a>
                     </div>
                 </div>
             </div>
        </section>


        <section id="quiz-section" class="mb-16">
            <h2 class="text-3xl font-bold mb-8 text-center text-gray-800 dark:text-gray-200">Thử thách Kiến thức Động vật!</h2>
            <div class="quiz-container max-w-2xl mx-auto bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg">
                <div id="quiz-content">
                    <p class="text-center text-gray-600 dark:text-gray-400">Đang tải câu hỏi...</p>
                </div>
                <div id="quiz-result" class="hidden text-center">
                    <h3 class="text-2xl font-semibold mb-4">Kết quả</h3>
                    <p class="text-lg mb-4">Bạn đã trả lời đúng <span id="correct-answers">0</span> trên <span id="total-questions">0</span> câu!</p>
                    <p id="quiz-feedback" class="font-medium mb-6"></p>
                    <button id="restart-quiz-btn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                        Chơi lại
                    </button>
                </div>
                <div id="quiz-progress" class="mt-6 hidden"> <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-1">
                         <span>Tiến độ</span>
                         <span id="progress-text">Câu 1 / 5</span>
                     </div>
                    <div class="progress-bar">
                        <div id="progress-bar-fill" class="progress-bar-fill" style="width: 0%;"></div>
                    </div>
                </div>
                 <button id="next-question-btn" class="hidden mt-6 w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                     Câu tiếp theo
                 </button>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-gray-300 py-8">
        <div class="container mx-auto text-center">
            <p>&copy; 2025 Động vật Hoang dã Thế giới.</p>
            <p class="text-sm mt-2">Bảo tồn là trách nhiệm của chúng ta</p>
             <div class="mt-4 space-x-4">
                 <a href="#" class="hover:text-emerald-400"><i class="fab fa-facebook fa-lg"></i></a>
                 <a href="#" class="hover:text-emerald-400"><i class="fab fa-twitter fa-lg"></i></a>
                 <a href="#" class="hover:text-emerald-400"><i class="fab fa-instagram fa-lg"></i></a>
             </div>
        </div>
    </footer>

    <div id="countries-modal" class="modal">
        <div class="modal-container">
             <button id="modal-back-button" data-modal-id="countries-modal" aria-label="Quay lại danh sách quốc gia">
                 <i class="fas fa-arrow-left"></i>
             </button>
             <button class="close-button" data-modal-id="countries-modal" aria-label="Đóng cửa sổ">
                <i class="fas fa-times"></i>
            </button>
            <div class="modal-content-area">
                <h2 id="modal-continent-title" class="text-2xl font-bold mb-6 text-center text-gray-800 dark:text-gray-200">Các quốc gia ở [Lục địa]</h2>
                <div id="countries-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 p-1 country-grid">
                    </div>
                <div id="modal-animal-list" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 p-1 modal-animal-grid">
                     </div>
            </div>
        </div>
    </div>

    <div id="animal-detail-modal" class="modal animal-detail-modal">
         <div class="animal-detail-container modal-container"> <button class="close-button" data-modal-id="animal-detail-modal" aria-label="Đóng cửa sổ"><i class="fas fa-times"></i></button>
            <div id="animal-detail-content">
                </div>
        </div>
    </div>

     <div id="endangered-modal" class="modal">
        <div class="modal-container">
            <button class="close-button" data-modal-id="endangered-modal" aria-label="Đóng cửa sổ"><i class="fas fa-times"></i></button>
            <div class="modal-content-area">
                <h2 class="text-2xl font-bold mb-6 text-center text-red-600 dark:text-red-400"><i class="fas fa-exclamation-triangle mr-2"></i>Các loài bị đe dọa</h2>
                 <div id="endangered-list" class="grid grid-cols-1 sm:grid-cols-2 gap-4 p-1">
                     <div class="border dark:border-gray-700 rounded-lg p-4 flex items-center space-x-3">
                         <img src="https://placehold.co/60x60/ef4444/FFFFFF?text=CR" alt="CR" class="w-10 h-10 rounded-full flex-shrink-0" onerror="this.src='https://placehold.co/60x60/cccccc/FFFFFF?text=Img'">
                         <div>
                             <h4 class="font-semibold text-gray-800 dark:text-gray-200">Tê giác Java</h4>
                             <p class="text-sm text-gray-600 dark:text-gray-400">Tình trạng: Cực kỳ nguy cấp (CR)</p>
                             <p class="text-xs text-gray-500 dark:text-gray-500">Châu Á</p>
                         </div>
                     </div>
                     <div class="border dark:border-gray-700 rounded-lg p-4 flex items-center space-x-3">
                         <img src="https://placehold.co/60x60/ef4444/FFFFFF?text=CR" alt="CR" class="w-10 h-10 rounded-full flex-shrink-0" onerror="this.src='https://placehold.co/60x60/cccccc/FFFFFF?text=Img'">
                         <div>
                             <h4 class="font-semibold text-gray-800 dark:text-gray-200">Báo Amur</h4>
                             <p class="text-sm text-gray-600 dark:text-gray-400">Tình trạng: Cực kỳ nguy cấp (CR)</p>
                              <p class="text-xs text-gray-500 dark:text-gray-500">Châu Á</p>
                         </div>
                     </div>
                     <div class="border dark:border-gray-700 rounded-lg p-4 flex items-center space-x-3">
                         <img src="https://placehold.co/60x60/f97316/FFFFFF?text=EN" alt="EN" class="w-10 h-10 rounded-full flex-shrink-0" onerror="this.src='https://placehold.co/60x60/cccccc/FFFFFF?text=Img'">
                         <div>
                             <h4 class="font-semibold text-gray-800 dark:text-gray-200">Hổ</h4>
                             <p class="text-sm text-gray-600 dark:text-gray-400">Tình trạng: Nguy cấp (EN)</p>
                              <p class="text-xs text-gray-500 dark:text-gray-500">Châu Á</p>
                         </div>
                     </div>
                     <div class="border dark:border-gray-700 rounded-lg p-4 flex items-center space-x-3">
                         <img src="https://placehold.co/60x60/f97316/FFFFFF?text=EN" alt="EN" class="w-10 h-10 rounded-full flex-shrink-0" onerror="this.src='https://placehold.co/60x60/cccccc/FFFFFF?text=Img'">
                         <div>
                             <h4 class="font-semibold text-gray-800 dark:text-gray-200">Gấu trúc lớn</h4>
                             <p class="text-sm text-gray-600 dark:text-gray-400">Tình trạng: Sắp nguy cấp (VU) - (Đã cải thiện từ EN)</p>
                              <p class="text-xs text-gray-500 dark:text-gray-500">Châu Á</p>
                         </div>
                     </div>
                      <div class="border dark:border-gray-700 rounded-lg p-4 flex items-center space-x-3">
                         <img src="https://placehold.co/60x60/eab308/FFFFFF?text=VU" alt="VU" class="w-10 h-10 rounded-full flex-shrink-0" onerror="this.src='https://placehold.co/60x60/cccccc/FFFFFF?text=Img'">
                         <div>
                             <h4 class="font-semibold text-gray-800 dark:text-gray-200">Sư tử châu Phi</h4>
                             <p class="text-sm text-gray-600 dark:text-gray-400">Tình trạng: Sắp nguy cấp (VU)</p>
                              <p class="text-xs text-gray-500 dark:text-gray-500">Châu Phi</p>
                         </div>
                     </div>
                      <div class="border dark:border-gray-700 rounded-lg p-4 flex items-center space-x-3">
                         <img src="https://placehold.co/60x60/eab308/FFFFFF?text=VU" alt="VU" class="w-10 h-10 rounded-full flex-shrink-0" onerror="this.src='https://placehold.co/60x60/cccccc/FFFFFF?text=Img'">
                         <div>
                             <h4 class="font-semibold text-gray-800 dark:text-gray-200">Báo tuyết</h4>
                             <p class="text-sm text-gray-600 dark:text-gray-400">Tình trạng: Sắp nguy cấp (VU)</p>
                              <p class="text-xs text-gray-500 dark:text-gray-500">Châu Á</p>
                         </div>
                     </div>
                 </div>
                 <div class="mt-6 text-xs text-center text-gray-500 dark:text-gray-400">
                     Tình trạng dựa trên Sách Đỏ IUCN: CR (Cực kỳ nguy cấp), EN (Nguy cấp), VU (Sắp nguy cấp).
                 </div>
            </div>
        </div>
    </div>


    <div id="favorites-drawer" class="favorites-drawer p-6 overflow-y-auto">
         <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800 dark:text-gray-200">Động vật Yêu thích</h2>
            <button id="close-favorites-drawer" class="close-drawer-button"><i class="fas fa-times"></i></button>
         </div>
        <div id="favorites-list">
            <p class="text-gray-500 dark:text-gray-400 text-center">Chưa có động vật yêu thích nào.</p>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;
        const navbar = document.getElementById('navbar');
        const continentCards = document.querySelectorAll('.continent-card');
        const modalContinentTitle = document.getElementById('modal-continent-title');
        const countriesList = document.getElementById('countries-list');
        const modalAnimalList = document.getElementById('modal-animal-list'); // Danh sách động vật trong modal
        const modalBackButton = document.getElementById('modal-back-button'); // Nút quay lại trong modal
        const animalDetailContent = document.getElementById('animal-detail-content');
        const favoritesToggle = document.getElementById('favorites-toggle');
        const favoritesDrawer = document.getElementById('favorites-drawer');
        const favoritesList = document.getElementById('favorites-list');
        const favoritesCount = document.getElementById('favorites-count');
        const closeFavoritesDrawer = document.getElementById('close-favorites-drawer');
        const quizContent = document.getElementById('quiz-content');
        const quizResult = document.getElementById('quiz-result');
        const quizProgress = document.getElementById('quiz-progress');
        const progressBarFill = document.getElementById('progress-bar-fill');
        const progressText = document.getElementById('progress-text');
        const nextQuestionBtn = document.getElementById('next-question-btn');
        const restartQuizBtn = document.getElementById('restart-quiz-btn');
        const correctAnswersSpan = document.getElementById('correct-answers');
        const totalQuestionsSpan = document.getElementById('total-questions');
        const quizFeedback = document.getElementById('quiz-feedback');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const endangeredSpeciesBtn = document.getElementById('endangered-species-btn');
        const mapContainer = document.getElementById('map-container');
        const mapMarkers = document.querySelectorAll('.map-marker');
        const modals = document.querySelectorAll('.modal'); // Lấy tất cả modal
        const closeButtons = document.querySelectorAll('.close-button'); // Lấy tất cả nút đóng modal


        // --- Dữ liệu giả lập ---
        const wildlifeData = {
            // Dữ liệu động vật theo quốc gia (ví dụ)
            'Kenya': [
                { id: 1, name: 'Sư tử', description: 'Loài mèo lớn sống theo bầy đàn, được mệnh danh là "vua của đồng cỏ".', image: 'https://placehold.co/400x240/f59e0b/FFFFFF?text=Sư+tử', conservation: 'VU', diet: 'Thịt', habitat: 'Đồng cỏ Savan' },
                { id: 2, name: 'Voi châu Phi', description: 'Động vật trên cạn lớn nhất, có trí thông minh cao và cấu trúc xã hội phức tạp.', image: 'https://placehold.co/400x240/78716c/FFFFFF?text=Voi+châu+Phi', conservation: 'EN', diet: 'Cỏ, lá cây', habitat: 'Savan, rừng' },
                { id: 3, name: 'Hươu cao cổ', description: 'Loài động vật cao nhất thế giới, nổi bật với chiếc cổ dài đặc trưng.', image: 'https://placehold.co/400x240/ca8a04/FFFFFF?text=Hươu+cao+cổ', conservation: 'VU', diet: 'Lá cây', habitat: 'Đồng cỏ, rừng thưa' }
            ],
            'Brazil': [
                 { id: 4, name: 'Báo đốm (Jaguar)', description: 'Loài mèo lớn thứ ba thế giới, kẻ săn mồi đỉnh cao của rừng Amazon.', image: 'https://placehold.co/400x240/44403c/FFFFFF?text=Báo+đốm', conservation: 'NT', diet: 'Thịt', habitat: 'Rừng mưa nhiệt đới' },
                 { id: 5, name: 'Khỉ Howler', description: 'Nổi tiếng với tiếng hú lớn có thể nghe xa hàng km, sống trên cây.', image: 'https://placehold.co/400x240/a16207/FFFFFF?text=Khỉ+Howler', conservation: 'LC', diet: 'Lá, quả', habitat: 'Rừng mưa nhiệt đới' },
                 { id: 6, name: 'Cá heo sông Amazon', description: 'Loài cá heo nước ngọt có màu hồng đặc trưng, sống ở lưu vực sông Amazon.', image: 'https://placehold.co/400x240/ec4899/FFFFFF?text=Cá+heo+hồng', conservation: 'EN', diet: 'Cá', habitat: 'Sông nước ngọt' }
            ],
             'Ấn Độ': [
                 { id: 7, name: 'Hổ Bengal', description: 'Phân loài hổ phổ biến nhất, biểu tượng quốc gia của Ấn Độ.', image: 'https://placehold.co/400x240/f97316/FFFFFF?text=Hổ+Bengal', conservation: 'EN', diet: 'Thịt', habitat: 'Rừng, đồng cỏ' },
                 { id: 8, name: 'Voi Ấn Độ', description: 'Nhỏ hơn voi châu Phi, dễ thuần hóa và có vai trò văn hóa quan trọng.', image: 'https://placehold.co/400x240/6b7280/FFFFFF?text=Voi+Ấn+Độ', conservation: 'EN', diet: 'Cỏ, lá cây', habitat: 'Rừng, đồng cỏ' },
                 { id: 9, name: 'Tê giác một sừng', description: 'Loài tê giác lớn với lớp da dày như áo giáp, sống ở vùng đồng cỏ ẩm ướt.', image: 'https://placehold.co/400x240/57534e/FFFFFF?text=Tê+giác+1+sừng', conservation: 'VU', diet: 'Cỏ', habitat: 'Đồng cỏ ẩm, đầm lầy' }
             ],
             'Úc': [
                 { id: 10, name: 'Kangaroo đỏ', description: 'Loài thú có túi lớn nhất, biểu tượng của nước Úc.', image: 'https://placehold.co/400x240/dc2626/FFFFFF?text=Kangaroo+đỏ', conservation: 'LC', diet: 'Cỏ', habitat: 'Vùng khô cằn, bán khô cằn' },
                 { id: 11, name: 'Koala', description: 'Loài thú có túi sống trên cây, thức ăn chủ yếu là lá bạch đàn.', image: 'https://placehold.co/400x240/9ca3af/FFFFFF?text=Koala', conservation: 'VU', diet: 'Lá bạch đàn', habitat: 'Rừng bạch đàn' },
                 { id: 12, name: 'Thú mỏ vịt', description: 'Loài động vật có vú đẻ trứng độc đáo với chiếc mỏ giống vịt.', image: 'https://placehold.co/400x240/854d0e/FFFFFF?text=Thú+mỏ+vịt', conservation: 'NT', diet: 'Côn trùng, giáp xác', habitat: 'Sông, hồ nước ngọt' }
             ],
             'Việt Nam': [
                  { id: 13, name: 'Sao la', description: 'Loài kỳ lân châu Á bí ẩn, cực kỳ nguy cấp, sống ở dãy Trường Sơn.', image: 'https://placehold.co/400x240/65a30d/FFFFFF?text=Sao+la', conservation: 'CR', diet: 'Lá cây', habitat: 'Rừng rậm' },
                  { id: 14, name: 'Voọc chà vá chân nâu', description: 'Loài linh trưởng đầy màu sắc, được mệnh danh là "nữ hoàng linh trưởng".', image: 'https://placehold.co/400x240/fbbf24/FFFFFF?text=Voọc+chà+vá', conservation: 'EN', diet: 'Lá, quả', habitat: 'Rừng' },
             ],
             'Hoa Kỳ': [
                  { id: 15, name: 'Bò rừng Bison', description: 'Loài động vật có vú lớn nhất Bắc Mỹ, từng suýt tuyệt chủng.', image: 'https://placehold.co/400x240/7c2d12/FFFFFF?text=Bò+rừng+Bison', conservation: 'NT', diet: 'Cỏ', habitat: 'Đồng cỏ' },
                  { id: 16, name: 'Đại bàng đầu trắng', description: 'Biểu tượng quốc gia của Hoa Kỳ, loài chim săn mồi oai vệ.', image: 'https://placehold.co/400x240/eab308/FFFFFF?text=Đại+bàng', conservation: 'LC', diet: 'Cá, động vật nhỏ', habitat: 'Gần sông hồ, bờ biển' },
             ]
        };

        const countriesByContinent = {
            'Châu Phi': ['Kenya', 'Ai Cập', 'Nam Phi', 'Nigeria', 'Tanzania', 'Ma-rốc'],
            'Châu Á': ['Ấn Độ', 'Trung Quốc', 'Nhật Bản', 'Việt Nam', 'Thái Lan', 'Indonesia'],
            'Châu Âu': ['Pháp', 'Đức', 'Ý', 'Tây Ban Nha', 'Anh', 'Na Uy'],
            'Bắc Mỹ': ['Hoa Kỳ', 'Canada', 'Mexico'],
            'Nam Mỹ': ['Brazil', 'Argentina', 'Peru', 'Colombia', 'Chile'],
            'Châu Đại Dương': ['Úc', 'New Zealand', 'Papua New Guinea', 'Fiji']
        };

        const quizQuestions = [
            { question: "Loài động vật nào được mệnh danh là 'vua của đồng cỏ' châu Phi?", options: ["Sư tử", "Báo Gêpa", "Linh cẩu", "Voi"], correctAnswer: "Sư tử", image: "https://placehold.co/300x150/f59e0b/FFFFFF?text=Câu+hỏi+1" },
            { question: "Đâu là loài thú có túi lớn nhất thế giới?", options: ["Koala", "Wombat", "Kangaroo đỏ", "Quỷ Tasmania"], correctAnswer: "Kangaroo đỏ", image: "https://placehold.co/300x150/dc2626/FFFFFF?text=Câu+hỏi+2" },
            { question: "Loài gấu nào có nguồn gốc từ Trung Quốc và ăn chủ yếu là tre?", options: ["Gấu nâu", "Gấu Bắc Cực", "Gấu trúc lớn", "Gấu lợn"], correctAnswer: "Gấu trúc lớn", image: "https://placehold.co/300x150/9ca3af/FFFFFF?text=Câu+hỏi+3" },
            { question: "Loài chim nào là biểu tượng quốc gia của Hoa Kỳ?", options: ["Thiên nga", "Đại bàng đầu trắng", "Cú tuyết", "Hồng hạc"], correctAnswer: "Đại bàng đầu trắng", image: "https://placehold.co/300x150/eab308/FFFFFF?text=Câu+hỏi+4" },
            { question: "'Kỳ lân châu Á' là biệt danh của loài động vật cực kỳ nguy cấp nào ở Việt Nam?", options: ["Hổ Đông Dương", "Sao la", "Voọc mũi hếch", "Tê giác một sừng"], correctAnswer: "Sao la", image: "https://placehold.co/300x150/65a30d/FFFFFF?text=Câu+hỏi+5" }
        ];

        let currentQuizQuestionIndex = 0;
        let score = 0;
        let quizAnswered = false;
        let activeModalId = null;
        let currentModalContinent = null; // Lưu lục địa đang hiển thị trong modal

        // --- Trạng thái ---
        let favorites = JSON.parse(localStorage.getItem('wildlifeFavorites')) || [];
        let isDarkMode = localStorage.getItem('theme') === 'dark';

        // --- Functions ---

        const toggleTheme = () => {
            isDarkMode = !isDarkMode;
            body.classList.toggle('dark', isDarkMode);
            themeToggle.innerHTML = isDarkMode ? '<i class="fas fa-sun text-xl text-yellow-400"></i>' : '<i class="fas fa-moon text-xl"></i>';
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
             mapContainer.style.filter = isDarkMode ? 'invert(1) hue-rotate(180deg)' : 'none';
        };

        const applySavedTheme = () => {
            if (isDarkMode) {
                body.classList.add('dark');
                themeToggle.innerHTML = '<i class="fas fa-sun text-xl text-yellow-400"></i>';
                 mapContainer.style.filter = 'invert(1) hue-rotate(180deg)';
            } else {
                 themeToggle.innerHTML = '<i class="fas fa-moon text-xl"></i>';
                 mapContainer.style.filter = 'none';
            }
        };

        const openModal = (modalId) => {
            const modal = document.getElementById(modalId);
            if (!modal) return;

            let overlay = modal.querySelector('.modal-overlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.className = 'modal-overlay';
                overlay.onclick = () => closeModal(modalId);
                modal.insertBefore(overlay, modal.firstChild);
            }

            body.classList.add('body-no-scroll');
            modal.classList.add('open');
            activeModalId = modalId;
        };

        const closeModal = (modalId) => {
            const modal = document.getElementById(modalId);
            if (modal && modal.classList.contains('open')) {
                modal.classList.remove('open');
                // Chỉ bỏ khóa cuộn nếu không còn modal nào mở và drawer cũng đóng
                if (!document.querySelector('.modal.open') && !favoritesDrawer.classList.contains('open')) {
                    body.classList.remove('body-no-scroll');
                }
                activeModalId = null;
            }
        };

        // Hiển thị danh sách quốc gia trong modal
        const showCountries = (continent) => {
            currentModalContinent = continent; // Lưu lại lục địa hiện tại
            modalContinentTitle.textContent = `Các quốc gia ở ${continent}`;
            countriesList.innerHTML = ''; // Xóa danh sách cũ
            modalAnimalList.innerHTML = ''; // Xóa danh sách động vật cũ
            modalAnimalList.classList.add('hidden'); // Ẩn danh sách động vật
            countriesList.classList.remove('hidden'); // Hiện danh sách quốc gia
            modalBackButton.classList.remove('visible'); // Ẩn nút quay lại

            const countries = countriesByContinent[continent] || [];

            if (countries.length === 0) {
                 countriesList.innerHTML = '<p class="text-gray-500 dark:text-gray-400 col-span-full text-center">Chưa có dữ liệu cho lục địa này.</p>';
            } else {
                countries.forEach((country, index) => {
                    const countryCard = document.createElement('div');
                    countryCard.className = 'country-card dark:bg-gray-600 dark:hover:bg-gray-500';
                    countryCard.style.animationDelay = `${index * 0.05}s`;
                    countryCard.innerHTML = `
                        <div class="flag-container dark:border-gray-500">
                            <img src="https://flagcdn.com/w40/${getCountryCode(country).toLowerCase()}.png"
                                 srcset="https://flagcdn.com/w80/${getCountryCode(country).toLowerCase()}.png 2x"
                                 alt="Cờ ${country}" class="flag-img"
                                 onerror="this.onerror=null; this.src='https://placehold.co/40x27/cccccc/FFFFFF?text=Flag';">
                        </div>
                        <span class="font-medium text-gray-700 dark:text-gray-200">${country}</span>
                    `;
                    // Sửa đổi: Gọi showAnimalsInModal thay vì showAnimals
                    countryCard.onclick = () => showAnimalsInModal(country);
                    countriesList.appendChild(countryCard);
                });
            }
            openModal('countries-modal');
        };

        const getCountryCode = (countryName) => {
            const countryCodes = {
                'Kenya': 'KE', 'Ai Cập': 'EG', 'Nam Phi': 'ZA', 'Nigeria': 'NG', 'Tanzania': 'TZ', 'Ma-rốc': 'MA',
                'Ấn Độ': 'IN', 'Trung Quốc': 'CN', 'Nhật Bản': 'JP', 'Việt Nam': 'VN', 'Thái Lan': 'TH', 'Indonesia': 'ID',
                'Pháp': 'FR', 'Đức': 'DE', 'Ý': 'IT', 'Tây Ban Nha': 'ES', 'Anh': 'GB', 'Na Uy': 'NO',
                'Hoa Kỳ': 'US', 'Canada': 'CA', 'Mexico': 'MX',
                'Brazil': 'BR', 'Argentina': 'AR', 'Peru': 'PE', 'Colombia': 'CO', 'Chile': 'CL',
                'Úc': 'AU', 'New Zealand': 'NZ', 'Papua New Guinea': 'PG', 'Fiji': 'FJ'
            };
            return countryCodes[countryName] || 'xx';
        };

        // Hiển thị danh sách động vật BÊN TRONG modal quốc gia
        const showAnimalsInModal = (country) => {
             // Không đóng modal
             modalContinentTitle.textContent = `Động vật ở ${country}`; // Cập nhật tiêu đề modal
             countriesList.classList.add('hidden'); // Ẩn danh sách quốc gia
             modalAnimalList.innerHTML = ''; // Xóa nội dung động vật cũ
             modalAnimalList.classList.remove('hidden'); // Hiện danh sách động vật
             modalBackButton.classList.add('visible'); // Hiện nút quay lại

             const animals = wildlifeData[country] || [];

             if (animals.length === 0) {
                 modalAnimalList.innerHTML = '<p class="text-gray-500 dark:text-gray-400 col-span-full text-center">Chưa có dữ liệu động vật cho quốc gia này.</p>';
             } else {
                 animals.forEach((animal, index) => {
                     const isFavorite = favorites.some(fav => fav.id === animal.id);
                     const animalCard = document.createElement('div');
                     // Quan trọng: Sử dụng class 'animal-card' để áp dụng style và animation
                     animalCard.className = 'animal-card dark:bg-gray-700';
                     animalCard.style.animationDelay = `${index * 0.1}s`;
                     animalCard.innerHTML = `
                        <div class="animal-img-container">
                            <img src="${animal.image}" alt="${animal.name}" class="animal-img" onerror="this.onerror=null; this.src='https://placehold.co/400x240/cccccc/FFFFFF?text=Image+Not+Found';">
                            <div class="animal-overlay"></div>
                            <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-id="${animal.id}" aria-label="${isFavorite ? 'Bỏ yêu thích' : 'Thêm yêu thích'}">
                                <i class="fas fa-heart"></i>
                            </button>
                            <button class="info-btn" data-id="${animal.id}" aria-label="Xem chi tiết">
                                <i class="fas fa-info-circle"></i>
                            </button>
                        </div>
                        <div class="animal-content">
                            <h3 class="animal-title dark:text-gray-100">${animal.name}</h3>
                            <p class="animal-description dark:text-gray-400">${animal.description}</p>
                             <div class="mt-2">
                                <span class="badge ${getConservationBadge(animal.conservation)}">${getConservationStatus(animal.conservation)}</span>
                            </div>
                        </div>
                    `;
                     modalAnimalList.appendChild(animalCard);
                 });
                 // Thêm listener cho các thẻ động vật vừa tạo TRONG MODAL
                 addAnimalCardListeners(modalAnimalList);
             }
             // Không cần cuộn trang chính vì đang ở trong modal
        };


         const getConservationBadge = (status) => {
             switch (status) {
                 case 'CR': return 'badge-red';
                 case 'EN': return 'badge-red';
                 case 'VU': return 'badge-yellow';
                 case 'NT': return 'badge-blue';
                 case 'LC': return 'badge-green';
                 default: return 'badge-gray';
             }
         };

         const getConservationStatus = (status) => {
             switch (status) {
                 case 'CR': return 'Cực kỳ nguy cấp';
                 case 'EN': return 'Nguy cấp';
                 case 'VU': return 'Sắp nguy cấp';
                 case 'NT': return 'Sắp bị đe dọa';
                 case 'LC': return 'Ít quan tâm';
                 default: return 'Không xác định';
             }
         };


        // Hiển thị chi tiết động vật (trong modal riêng)
        const showAnimalDetail = (animalId) => {
             let animal = null;
             for (const country in wildlifeData) {
                 const found = wildlifeData[country].find(a => a.id === parseInt(animalId));
                 if (found) {
                     animal = found;
                     break;
                 }
             }

             if (!animal) {
                 animalDetailContent.innerHTML = '<p class="p-6 text-center text-gray-600 dark:text-gray-400">Không tìm thấy thông tin chi tiết.</p>';
                 openModal('animal-detail-modal');
                 return;
             }

             const isFavorite = favorites.some(fav => fav.id === animal.id);

             animalDetailContent.innerHTML = `
                <div class="animal-detail-img">
                    <img src="${animal.image}" alt="${animal.name}" onerror="this.onerror=null; this.src='https://placehold.co/640x384/cccccc/FFFFFF?text=Image+Not+Found';">
                    <div class="animal-detail-overlay"></div>
                    <h2 class="animal-detail-title">${animal.name}</h2>
                     <button class="favorite-btn absolute top-4 right-12 ${isFavorite ? 'active' : ''}" data-id="${animal.id}" aria-label="${isFavorite ? 'Bỏ yêu thích' : 'Thêm yêu thích'}">
                         <i class="fas fa-heart"></i>
                     </button>
                </div>
                <div class="animal-detail-content dark:bg-gray-700">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${animal.description}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1"><i class="fas fa-shield-alt mr-2 text-red-500"></i>Tình trạng bảo tồn:</h4>
                            <p><span class="badge ${getConservationBadge(animal.conservation)}">${getConservationStatus(animal.conservation)}</span></p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1"><i class="fas fa-utensils mr-2 text-yellow-500"></i>Chế độ ăn:</h4>
                            <p>${animal.diet || 'Không rõ'}</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1"><i class="fas fa-map-marker-alt mr-2 text-blue-500"></i>Môi trường sống:</h4>
                            <p>${animal.habitat || 'Không rõ'}</p>
                        </div>
                         <div>
                            <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1"><i class="fas fa-info-circle mr-2 text-green-500"></i>Thông tin thêm:</h4>
                            <p>Đây là nơi để thêm các thông tin thú vị khác về loài ${animal.name}.</p>
                        </div>
                    </div>
                     <div class="learn-more-section dark:bg-gray-800">
                         <h3 class="dark:text-gray-100">Tìm hiểu thêm</h3>
                         <p class="dark:text-gray-300">Bạn có thể tìm kiếm thêm thông tin về ${animal.name} trên các trang web uy tín như <a href="https://www.google.com/search?q=${encodeURIComponent(animal.name)}" target="_blank" rel="noopener noreferrer" class="text-emerald-600 dark:text-emerald-400 hover:underline">Google</a> hoặc <a href="https://vi.wikipedia.org/wiki/${encodeURIComponent(animal.name)}" target="_blank" rel="noopener noreferrer" class="text-emerald-600 dark:text-emerald-400 hover:underline">Wikipedia</a>.</p>
                     </div>
                </div>
            `;
             openModal('animal-detail-modal'); // Mở modal chi tiết RIÊNG

             // Thêm event listener cho nút yêu thích trong modal chi tiết
             const modalFavoriteBtn = animalDetailContent.querySelector('.favorite-btn');
             if (modalFavoriteBtn) {
                 modalFavoriteBtn.replaceWith(modalFavoriteBtn.cloneNode(true));
                 animalDetailContent.querySelector('.favorite-btn').addEventListener('click', (e) => {
                     e.stopPropagation();
                     toggleFavorite(animal.id);
                     const currentBtn = e.currentTarget;
                     const isNowFavorite = favorites.some(fav => fav.id === animal.id);
                     currentBtn.classList.toggle('active', isNowFavorite);
                     currentBtn.setAttribute('aria-label', isNowFavorite ? 'Bỏ yêu thích' : 'Thêm yêu thích');
                     // Cập nhật nút tương ứng trên card (nếu có, cả trong modal quốc gia và trang chính)
                      const cardFavoriteBtns = document.querySelectorAll(`.animal-card .favorite-btn[data-id="${animal.id}"]`);
                      cardFavoriteBtns.forEach(btn => {
                          btn.classList.toggle('active', isNowFavorite);
                          btn.setAttribute('aria-label', currentBtn.getAttribute('aria-label'));
                      });
                 });
             }
        };

        const toggleFavorite = (animalId) => {
            const id = parseInt(animalId);
            const index = favorites.findIndex(fav => fav.id === id);
             let animal = null;
             for (const country in wildlifeData) {
                 const found = wildlifeData[country].find(a => a.id === id);
                 if (found) {
                     animal = found;
                     break;
                 }
             }
             if (!animal) return;

            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                 favorites.push({ id: animal.id, name: animal.name, image: animal.image });
            }
            localStorage.setItem('wildlifeFavorites', JSON.stringify(favorites));
            updateFavoritesDisplay();
            // Cập nhật trạng thái nút yêu thích trên thẻ động vật đang hiển thị (nếu có)
             const visibleAnimalCardBtns = document.querySelectorAll(`.animal-card .favorite-btn[data-id="${id}"]`);
             visibleAnimalCardBtns.forEach(btn => {
                 const isNowFavorite = favorites.some(fav => fav.id === id);
                 btn.classList.toggle('active', isNowFavorite);
                 btn.setAttribute('aria-label', isNowFavorite ? 'Bỏ yêu thích' : 'Thêm yêu thích');
             });
             // Cập nhật nút trong modal chi tiết nếu đang mở
              const detailModal = document.getElementById('animal-detail-modal');
              if (detailModal && detailModal.classList.contains('open')) {
                  const detailFavBtn = detailModal.querySelector(`.favorite-btn[data-id="${id}"]`);
                  if (detailFavBtn) {
                      const isNowFavorite = favorites.some(fav => fav.id === id);
                      detailFavBtn.classList.toggle('active', isNowFavorite);
                      detailFavBtn.setAttribute('aria-label', isNowFavorite ? 'Bỏ yêu thích' : 'Thêm yêu thích');
                  }
              }
        };

        const updateFavoritesDisplay = () => {
            favoritesList.innerHTML = '';
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center">Chưa có động vật yêu thích nào.</p>';
                favoritesCount.classList.add('hidden');
            } else {
                favorites.forEach((fav, index) => {
                    const item = document.createElement('div');
                    item.className = 'favorite-item dark:bg-gray-600';
                    item.style.animationDelay = `${index * 0.05}s`;
                    item.innerHTML = `
                        <div class="favorite-item-img">
                            <img src="${fav.image}" alt="${fav.name}" onerror="this.onerror=null; this.src='https://placehold.co/80x80/cccccc/FFFFFF?text=Img';">
                        </div>
                        <div class="flex-grow">
                            <h4 class="font-semibold text-gray-800 dark:text-gray-200">${fav.name}</h4>
                            <button class="text-sm text-emerald-600 dark:text-emerald-400 hover:underline view-detail-btn" data-id="${fav.id}">Xem chi tiết</button>
                        </div>
                        <button class="remove-favorite-btn" data-id="${fav.id}" aria-label="Xóa khỏi yêu thích">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    `;
                    favoritesList.appendChild(item);
                });

                 favoritesList.querySelectorAll('.view-detail-btn').forEach(btn => {
                     btn.addEventListener('click', (e) => {
                         showAnimalDetail(e.target.dataset.id);
                         favoritesDrawer.classList.remove('open'); // Đóng drawer
                         if (!activeModalId) body.classList.remove('body-no-scroll'); // Mở scroll nếu ko có modal khác
                     });
                 });
                 favoritesList.querySelectorAll('.remove-favorite-btn').forEach(btn => {
                     btn.addEventListener('click', (e) => {
                          const idToRemove = e.currentTarget.dataset.id;
                          toggleFavorite(idToRemove); // toggleFavorite đã xử lý cập nhật nút
                     });
                 });
                 favoritesCount.textContent = favorites.length;
                 favoritesCount.classList.remove('hidden');
            }
        };

         // Gắn listener cho nút trên thẻ động vật (dùng cho cả modal và trang chính)
         const addAnimalCardListeners = (container) => {
             // Nút yêu thích
             container.querySelectorAll('.favorite-btn').forEach(btn => {
                 const newBtn = btn.cloneNode(true);
                 btn.parentNode.replaceChild(newBtn, btn);
                 newBtn.addEventListener('click', (e) => {
                     e.stopPropagation();
                     const id = e.currentTarget.dataset.id;
                     toggleFavorite(id); // toggleFavorite đã xử lý cập nhật nút
                 });
             });

             // Nút info -> Mở modal chi tiết riêng
             container.querySelectorAll('.info-btn').forEach(btn => {
                  const newBtn = btn.cloneNode(true);
                  btn.parentNode.replaceChild(newBtn, btn);
                 newBtn.addEventListener('click', (e) => {
                     e.stopPropagation();
                     showAnimalDetail(e.currentTarget.dataset.id);
                     // Không đóng modal quốc gia/động vật khi mở modal chi tiết
                 });
             });

             // Click vào card -> Mở modal chi tiết riêng
             container.querySelectorAll('.animal-card').forEach(card => {
                  const newCard = card.cloneNode(true);
                  card.parentNode.replaceChild(newCard, card);
                 newCard.addEventListener('click', (e) => {
                     if (!e.target.closest('.favorite-btn') && !e.target.closest('.info-btn')) {
                         const infoBtn = newCard.querySelector('.info-btn');
                         if (infoBtn) {
                             showAnimalDetail(infoBtn.dataset.id);
                             // Không đóng modal quốc gia/động vật khi mở modal chi tiết
                         }
                     }
                 });
                 newCard.style.cursor = 'pointer';
             });
         };

         // --- Quiz Functions ---
        const displayQuizQuestion = () => {
            quizAnswered = false;
            nextQuestionBtn.classList.add('hidden');
            quizContent.classList.remove('hidden');
            quizResult.classList.add('hidden');
            quizProgress.classList.remove('hidden');

            if (currentQuizQuestionIndex >= quizQuestions.length) {
                showQuizResult();
                return;
            }

            const questionData = quizQuestions[currentQuizQuestionIndex];
            quizContent.innerHTML = `
                ${questionData.image ? `<img src="${questionData.image}" alt="Câu hỏi ${currentQuizQuestionIndex + 1}" class="rounded-lg mb-4 mx-auto max-h-40" onerror="this.style.display='none'">` : ''}
                <p class="text-lg font-medium mb-4 text-gray-800 dark:text-gray-200">${currentQuizQuestionIndex + 1}. ${questionData.question}</p>
                <div class="space-y-3">
                    ${questionData.options.map(option => `
                        <button class="quiz-option dark:bg-gray-600 dark:hover:bg-gray-500 dark:border-gray-500 dark:text-gray-200" data-answer="${option}">
                            ${option}
                        </button>
                    `).join('')}
                </div>
            `;

            quizContent.querySelectorAll('.quiz-option').forEach(button => {
                button.addEventListener('click', handleQuizAnswer);
            });
            updateProgressBar();
        };

        const handleQuizAnswer = (event) => {
             if (quizAnswered) return;
             quizAnswered = true;

            const selectedOption = event.target.closest('.quiz-option');
            if (!selectedOption) return;

            const selectedAnswer = selectedOption.dataset.answer;
            const correctAnswer = quizQuestions[currentQuizQuestionIndex].correctAnswer;

            quizContent.querySelectorAll('.quiz-option').forEach(button => {
                button.disabled = true;
                 if (button !== selectedOption && button.dataset.answer !== correctAnswer) {
                     button.style.opacity = '0.6';
                 }
            });

            if (selectedAnswer === correctAnswer) {
                selectedOption.classList.add('correct');
                 selectedOption.innerHTML += ' <i class="fas fa-check ml-2"></i>';
                score++;
            } else {
                selectedOption.classList.add('incorrect');
                 selectedOption.innerHTML += ' <i class="fas fa-times ml-2"></i>';
                const correctButton = quizContent.querySelector(`.quiz-option[data-answer="${correctAnswer}"]`);
                if (correctButton) {
                    correctButton.classList.add('correct');
                     correctButton.innerHTML += ' <i class="fas fa-check ml-2"></i>';
                     correctButton.disabled = false;
                     correctButton.style.opacity = '1';
                }
            }

             if (currentQuizQuestionIndex < quizQuestions.length - 1) {
                 nextQuestionBtn.classList.remove('hidden');
             } else {
                 nextQuestionBtn.textContent = "Xem Kết quả";
                 nextQuestionBtn.classList.remove('hidden');
                 nextQuestionBtn.onclick = showQuizResult;
             }
        };

         const nextQuestion = () => {
             currentQuizQuestionIndex++;
             displayQuizQuestion();
              if (currentQuizQuestionIndex < quizQuestions.length - 1) {
                  nextQuestionBtn.textContent = "Câu tiếp theo";
                  nextQuestionBtn.onclick = nextQuestion;
              }
         };

        const showQuizResult = () => {
            quizContent.classList.add('hidden');
            quizProgress.classList.add('hidden');
            nextQuestionBtn.classList.add('hidden');
            quizResult.classList.remove('hidden');

            correctAnswersSpan.textContent = score;
            totalQuestionsSpan.textContent = quizQuestions.length;

            let feedbackText = "";
            const percentage = (score / quizQuestions.length) * 100;
            if (percentage === 100) {
                feedbackText = "Xuất sắc! Bạn là một chuyên gia động vật hoang dã! 🥇";
                 quizFeedback.className = 'font-medium mb-6 text-green-600 dark:text-green-400';
            } else if (percentage >= 75) {
                feedbackText = "Rất tốt! Kiến thức của bạn thật đáng nể! 👍";
                 quizFeedback.className = 'font-medium mb-6 text-blue-600 dark:text-blue-400';
            } else if (percentage >= 50) {
                feedbackText = "Khá tốt! Tiếp tục khám phá để tìm hiểu thêm nhé! 😊";
                 quizFeedback.className = 'font-medium mb-6 text-yellow-600 dark:text-yellow-400';
            } else {
                feedbackText = "Cần cố gắng hơn! Đừng lo, hãy tiếp tục học hỏi! 🤔";
                 quizFeedback.className = 'font-medium mb-6 text-red-600 dark:text-red-400';
            }
            quizFeedback.textContent = feedbackText;
        };

         const restartQuiz = () => {
             currentQuizQuestionIndex = 0;
             score = 0;
             displayQuizQuestion();
              nextQuestionBtn.textContent = "Câu tiếp theo";
              nextQuestionBtn.onclick = nextQuestion;
              quizResult.classList.add('hidden');
              quizProgress.classList.remove('hidden');
         };

        const updateProgressBar = () => {
            const progress = ((currentQuizQuestionIndex + 1) / quizQuestions.length) * 100;
            progressBarFill.style.width = `${progress}%`;
             progressText.textContent = `Câu ${currentQuizQuestionIndex + 1} / ${quizQuestions.length}`;
        };

        const handleTabClick = (event) => {
            const clickedTab = event.currentTarget;
            const targetTabId = clickedTab.dataset.tab;
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            clickedTab.classList.add('active');
            const targetContent = document.getElementById(`${targetTabId}-tab`);
            if (targetContent) {
                targetContent.classList.add('active');
            }
        };

        // --- Event Listeners ---
        themeToggle.addEventListener('click', toggleTheme);

        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled', 'dark:bg-gray-800/80', 'bg-white/80');
            } else {
                navbar.classList.remove('scrolled', 'dark:bg-gray-800/80', 'bg-white/80');
            }
        });

        continentCards.forEach(card => {
            card.addEventListener('click', () => {
                showCountries(card.dataset.continent);
            });
        });

        favoritesToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            favoritesDrawer.classList.add('open');
            body.classList.add('body-no-scroll');
        });
        closeFavoritesDrawer.addEventListener('click', () => {
            favoritesDrawer.classList.remove('open');
            if (!activeModalId) body.classList.remove('body-no-scroll');
        });

        closeButtons.forEach(button => {
            button.addEventListener('click', () => {
                const modalId = button.dataset.modalId;
                if (modalId) closeModal(modalId);
            });
        });

        // Listener cho nút quay lại trong modal quốc gia/động vật
        modalBackButton.addEventListener('click', () => {
            if (currentModalContinent) {
                showCountries(currentModalContinent); // Gọi lại showCountries để hiển thị danh sách quốc gia
            }
        });


         window.addEventListener('keydown', (e) => {
             if (e.key === 'Escape') {
                 if (activeModalId) {
                     closeModal(activeModalId);
                 } else if (favoritesDrawer.classList.contains('open')) {
                      favoritesDrawer.classList.remove('open');
                      body.classList.remove('body-no-scroll');
                 }
             }
         });

         document.addEventListener('click', (e) => {
             if (favoritesDrawer.classList.contains('open') &&
                 !favoritesDrawer.contains(e.target) &&
                 !favoritesToggle.contains(e.target))
             {
                 favoritesDrawer.classList.remove('open');
                 if (!activeModalId) body.classList.remove('body-no-scroll');
             }
         });

         // Gắn listener ban đầu cho các thẻ động vật tĩnh (nếu có)
         document.querySelectorAll('.animal-grid').forEach(grid => {
             addAnimalCardListeners(grid);
         });

         nextQuestionBtn.addEventListener('click', nextQuestion);
         restartQuizBtn.addEventListener('click', restartQuiz);
         tabButtons.forEach(button => button.addEventListener('click', handleTabClick));
         endangeredSpeciesBtn.addEventListener('click', () => openModal('endangered-modal'));

        // --- Initialization ---
        applySavedTheme();
        updateFavoritesDisplay();
        displayQuizQuestion();

         document.addEventListener('DOMContentLoaded', () => {
             const hash = window.location.hash.substring(1);
             if (hash) {
                 const tabButton = document.querySelector(`.tab-button[data-tab="${hash}"]`);
                 const targetSection = document.getElementById(hash) || document.getElementById(`${hash}-tab`) || document.getElementById(`${hash}-section`);

                 if (tabButton) {
                     handleTabClick({ currentTarget: tabButton });
                     const tabContainer = tabButton.closest('section');
                      if (tabContainer) {
                          setTimeout(() => {
                               tabContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                          }, 100);
                      }
                 } else if (targetSection) {
                      setTimeout(() => {
                           targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                      }, 100);
                 }
             }
         });

    </script>
</body>
</html>
